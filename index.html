<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.26.1">


<link href="css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "";
</script>

  <meta id="repository-name" content="github.com/icyleaf/totem">
  <title>README - github.com/icyleaf/totem</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false">
    </div>

    <div class="repository-links">
      <a href="index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="github.com/icyleaf/totem/Totem" data-name="totem">
      <a href="Totem.html">Totem</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/icyleaf/totem/Totem/Any" data-name="totem::any">
      <a href="Totem/Any.html">Any</a>
      
        <ul>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Any/Type" data-name="totem::any::type">
      <a href="Totem/Any/Type.html">Type</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Config" data-name="totem::config">
      <a href="Totem/Config.html">Config</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/ConfigBuilder" data-name="totem::configbuilder">
      <a href="Totem/ConfigBuilder.html">ConfigBuilder</a>
      
    </li>
  
  <li class="parent " data-id="github.com/icyleaf/totem/Totem/ConfigTypes" data-name="totem::configtypes">
      <a href="Totem/ConfigTypes.html">ConfigTypes</a>
      
        <ul>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/ConfigTypes/Adapter" data-name="totem::configtypes::adapter">
      <a href="Totem/ConfigTypes/Adapter.html">Adapter</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/ConfigTypes/Env" data-name="totem::configtypes::env">
      <a href="Totem/ConfigTypes/Env.html">Env</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/ConfigTypes/JSON" data-name="totem::configtypes::json">
      <a href="Totem/ConfigTypes/JSON.html">JSON</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/ConfigTypes/YAML" data-name="totem::configtypes::yaml">
      <a href="Totem/ConfigTypes/YAML.html">YAML</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/icyleaf/totem/Totem/Exception" data-name="totem::exception">
      <a href="Totem/Exception.html">Exception</a>
      
        <ul>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Exception/MappingError" data-name="totem::exception::mappingerror">
      <a href="Totem/Exception/MappingError.html">MappingError</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Exception/NotFoundConfigFileError" data-name="totem::exception::notfoundconfigfileerror">
      <a href="Totem/Exception/NotFoundConfigFileError.html">NotFoundConfigFileError</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Exception/NotFoundConfigKeyError" data-name="totem::exception::notfoundconfigkeyerror">
      <a href="Totem/Exception/NotFoundConfigKeyError.html">NotFoundConfigKeyError</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Exception/RemoteProviderError" data-name="totem::exception::remoteprovidererror">
      <a href="Totem/Exception/RemoteProviderError.html">RemoteProviderError</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Exception/UnsupportedConfigError" data-name="totem::exception::unsupportedconfigerror">
      <a href="Totem/Exception/UnsupportedConfigError.html">UnsupportedConfigError</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Exception/UnsupportedRemoteProviderError" data-name="totem::exception::unsupportedremoteprovidererror">
      <a href="Totem/Exception/UnsupportedRemoteProviderError.html">UnsupportedRemoteProviderError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/icyleaf/totem/Totem/RemoteProviders" data-name="totem::remoteproviders">
      <a href="Totem/RemoteProviders.html">RemoteProviders</a>
      
        <ul>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/RemoteProviders/Adapter" data-name="totem::remoteproviders::adapter">
      <a href="Totem/RemoteProviders/Adapter.html">Adapter</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/RemoteProviders/Etcd" data-name="totem::remoteproviders::etcd">
      <a href="Totem/RemoteProviders/Etcd.html">Etcd</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/RemoteProviders/Redis" data-name="totem::remoteproviders::redis">
      <a href="Totem/RemoteProviders/Redis.html">Redis</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/icyleaf/totem/Totem/Utils" data-name="totem::utils">
      <a href="Totem/Utils.html">Utils</a>
      
        <ul>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Utils/EnvHelper" data-name="totem::utils::envhelper">
      <a href="Totem/Utils/EnvHelper.html">EnvHelper</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Utils/FileHelper" data-name="totem::utils::filehelper">
      <a href="Totem/Utils/FileHelper.html">FileHelper</a>
      
    </li>
  
  <li class=" " data-id="github.com/icyleaf/totem/Totem/Utils/HashHelper" data-name="totem::utils::hashhelper">
      <a href="Totem/Utils/HashHelper.html">HashHelper</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p><img src="https://github.com/icyleaf/totem/raw/master/logo-small.png" alt="totem-logo"/></p>

<h1>Totem</h1>

<p><a href="https://github.com/crystal-lang/crystal" target="_blank"><img src="https://img.shields.io/badge/language-crystal-776791.svg" alt="Language"/></a>
<a href="https://github.com/icyleaf/totem/blob/master/CHANGELOG.md" target="_blank"><img src="https://img.shields.io/github/tag/icyleaf/totem.svg" alt="Tag"/></a>
<a href="https://circleci.com/gh/icyleaf/totem" target="_blank"><img src="https://img.shields.io/circleci/project/github/icyleaf/totem/master.svg?style=flat" alt="Build Status"/></a></p>

<p>Crystal configuration with spirit. Inspired from Go's <a href="https://github.com/spf13/viper" target="_blank">viper</a>. Totem Icon by lastspark from <a href="https://thenounproject.com" target="_blank">Noun Project</a>.</p>

<p>Configuration file formats is always the problem, you want to focus on building awesome things. Totem is here to help with that.</p>

<p>Totem has following features:</p>

<ul><li>Reading from JSON, YAML, dotenv formats config files or raw string.</li><li>Reading from environment variables.</li><li>Reading from remote key-value store systems(redis/etcd).</li><li>Provide a mechanism to set default values for your different configuration options.</li><li>Provide an alias system to easily rename parameters without breaking existing code.</li><li>Write configuration to file with JSON, YAML formats.</li></ul>

<p>And we keep it minimize and require what you want with adapter and remote provider! <strong>No more dependenices what you do not need</strong>.
Only JSON and YAML adapters were auto requires.</p>

<p>Uses the following precedence order. Each item takes precedence over the item below it:</p>

<ul><li>alias</li><li>override, explicit call to <code>set</code></li><li>env</li><li>config</li><li>kvstores</li><li>default</li></ul>

<p>Totem configuration keys are case insensitive.</p>

<p>&lt;!-- TOC --></p>

<ul><li><a href="#installation" target="_blank">Installation</a></li><li><a href="#quick-start" target="_blank">Quick Start</a></li><ul><li><a href="#operating-configuration" target="_blank">Operating configuration</a></li><li><a href="#loading-configuration" target="_blank">Loading configuration</a></li><li><a href="#from-raw-string" target="_blank">From raw string</a></li><li><a href="#from-file" target="_blank">From file</a></li></ul><li><a href="#usage" target="_blank">Usage</a></li><ul><li><a href="#load-configuration-with-multiple-paths" target="_blank">Load configuration with multiple paths</a></li><li><a href="#set-alias-and-using-alias" target="_blank">Set Alias and using alias</a></li><li><a href="#working-with-nested-key" target="_blank">Working with nested key</a></li><li><a href="#working-with-envoriment-variables" target="_blank">Working with envoriment variables</a></li><li><a href="#working-with-remote-providers" target="_blank">Working with remote providers</a></li><li><a href="#use-redis" target="_blank">Use redis</a></li><li><a href="#use-etcd" target="_blank">Use etcd</a></li><li><a href="#iterating-configuration" target="_blank">Iterating configuration</a></li><li><a href="#serialization" target="_blank">Serialization</a></li><li><a href="#storing-configuration-to-file" target="_blank">Storing configuration to file</a></li></ul><li><a href="#advanced-usage" target="_blank">Advanced Usage</a></li><ul><li><a href="#custom-adapter" target="_blank">Custom adapter</a></li><li><a href="#write-custom-remote-provider" target="_blank">Write custom remote provider</a></li></ul><li><a href="#q--a" target="_blank">Q & A</a></li><ul><li><a href="#how-to-debug" target="_blank">How to debug?</a></li></ul><li><a href="#help-and-discussion" target="_blank">Help and Discussion</a></li><li><a href="#donate" target="_blank">Donate</a></li><li><a href="#how-to-contribute" target="_blank">How to Contribute</a></li><li><a href="#you-may-also-like" target="_blank">You may also like</a></li><li><a href="#license" target="_blank">License</a></li></ul>

<p>&lt;!-- /TOC --></p>

<h2>Installation</h2>

<p>Add this to your application's <code>shard.yml</code>:</p>

<pre><code class="language-yaml">dependencies:
  totem:
    github: icyleaf/totem</code></pre>

<h2>Quick Start</h2>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;totem&quot;</span></code></pre>

<h3>Operating configuration</h3>

<pre><code class="language-crystal">totem <span class="o">=</span> <span class="t">Totem</span>.<span class="k">new</span>
totem.set_default(<span class="s">&quot;name&quot;</span>, <span class="s">&quot;foo&quot;</span>)
totem.set_defaults({
  <span class="s">&quot;age&quot;</span>    => <span class="n">18</span>,
  <span class="s">&quot;gender&quot;</span> => <span class="s">&quot;male&quot;</span>,
  <span class="s">&quot;hobbies&quot;</span> => [
    <span class="s">&quot;skateboarding&quot;</span>,
    <span class="s">&quot;snowboarding&quot;</span>,
    <span class="s">&quot;go&quot;</span>
  ]
})

totem.get(<span class="s">&quot;name&quot;</span>).as_s <span class="c"># =&gt; &quot;foo&quot;</span>
totem.get(<span class="s">&quot;age&quot;</span>).as_i <span class="c"># =&gt; 18</span>
totem.set(<span class="s">&quot;name&quot;</span>, <span class="s">&quot;bar&quot;</span>)
totem.<span class="k">alias</span>(alias_key: <span class="s">&quot;key&quot;</span>, key: <span class="s">&quot;name&quot;</span>)
totem.get(<span class="s">&quot;name&quot;</span>).as_s <span class="c"># =&gt; &quot;bar&quot;</span>
totem.get(<span class="s">&quot;key&quot;</span>).as_s <span class="c"># =&gt; &quot;bar&quot;</span></code></pre>

<h3>Loading configuration</h3>

<p>Support <code>JSON</code>, <code>YAML</code> and dotenv data from raw string and file.</p>

<h4>From raw string</h4>

<p>Load yaml string</p>

<pre><code class="language-crystal">raw <span class="o">=</span> <span class="s">&lt;&lt;-EOF
Hacker: true
name: steve
hobbies:
- skateboarding
- snowboarding
- go
clothing:
  jacket: leather
  trousers: denim
  pants:
    size: large
age: 35
eyes : brown
EOF</span>

totem <span class="o">=</span> <span class="t">Totem</span>.from_yaml raw
totem.get(<span class="s">&quot;Hacker&quot;</span>).as_bool                           <span class="c"># =&gt; true</span>
totem.get(<span class="s">&quot;age&quot;</span>).as_i                                 <span class="c"># =&gt; 35</span>
totem.get(<span class="s">&quot;clothing&quot;</span>).as_h[<span class="s">&quot;pants&quot;</span>].as_h[<span class="s">&quot;size&quot;</span>].as_s <span class="c"># =&gt; &quot;large&quot;</span></code></pre>

<p>Load json string</p>

<pre><code class="language-crystal">raw <span class="o">=</span> <span class="s">&lt;&lt;-EOF
{
  &quot;id&quot;: &quot;0001&quot;,
  &quot;type&quot;: &quot;donut&quot;,
  &quot;name&quot;: &quot;Cake&quot;,
  &quot;ppu&quot;: 0.55,
  &quot;batters&quot;: {
    &quot;batter&quot;: [
      {
        &quot;type&quot;: &quot;Regular&quot;
      },
      {
        &quot;type&quot;: &quot;Chocolate&quot;
      },
      {
        &quot;type&quot;: &quot;Blueberry&quot;
      },
      {
        &quot;type&quot;: &quot;Devil&#39;s Food&quot;
      }
    ]
  }
}
EOF</span>

totem <span class="o">=</span> <span class="t">Totem</span>.from_json raw
totem.get(<span class="s">&quot;name&quot;</span>)                                         <span class="c"># =&gt; &quot;Cake&quot;</span>
totem.get(<span class="s">&quot;ppu&quot;</span>)                                          <span class="c"># =&gt; 0.55</span>
totem.get(<span class="s">&quot;batters&quot;</span>).as_h[<span class="s">&quot;batter&quot;</span>].as_a[<span class="n">0</span>].as_h[<span class="s">&quot;type&quot;</span>]  <span class="c"># =&gt; &quot;Regular&quot;</span></code></pre>

<p>Load dotenv string</p>

<blockquote>Add <a href="https://github.com/icyleaf/poncho" target="_blank">poncho</a> to <code>shards.yml</code> and require the adapter.</blockquote>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;totem&quot;</span>
<span class="k">require</span> <span class="s">&quot;totem/config_types/env&quot;</span>    <span class="c"># Make sure you require</span>

raw <span class="o">=</span> <span class="s">&lt;&lt;-EOF
# COMMENTS=work
STR=&#39;foo&#39;
STR_WITH_COMMENTS=bar         # str with comment
STR_WITH_HASH_SYMBOL=&quot;abc#123&quot;#stick comment
INT=33
EOF</span>

totem <span class="o">=</span> <span class="t">Totem</span>.from_env raw
totem.get(<span class="s">&quot;str&quot;</span>)                    <span class="c"># =&gt; &quot;foo&quot;</span>
totem.get(<span class="s">&quot;str_with_comments&quot;</span>)      <span class="c"># =&gt; bar</span>
totem.get(<span class="s">&quot;str_with_hash_symbol&quot;</span>)   <span class="c"># =&gt; &quot;abc#123&quot;</span>
totem.get(<span class="s">&quot;int&quot;</span>)                    <span class="c"># =&gt; &quot;33&quot;</span></code></pre>

<h4>From file</h4>

<blockquote>Add <a href="https://github.com/icyleaf/poncho" target="_blank">poncho</a> to <code>shards.yml</code> and require the adapter if you need load dotenv file.</blockquote>

<pre><code class="language-crystal"><span class="c"># Load yaml file from file with path</span>
totem <span class="o">=</span> <span class="t">Totem</span>.from_file <span class="s">&quot;./spec/fixtures/config.yaml&quot;</span>

<span class="c"># Load json file from file with multi-paths</span>
totem <span class="o">=</span> <span class="t">Totem</span>.from_file <span class="s">&quot;config.yaml&quot;</span>, [<span class="s">&quot;/etc&quot;</span>, <span class="s">&quot;.&quot;</span>, <span class="s">&quot;./spec/fixtures&quot;</span>]

<span class="c"># Load dotenv file</span>
totem <span class="o">=</span> <span class="t">Totem</span>.from_file <span class="s">&quot;config.env&quot;</span></code></pre>

<h2>Usage</h2>

<h3>Load configuration with multiple paths</h3>

<p>Totem can search multiple paths, but currently a single Totem instance only supports a single
configuration file.</p>

<pre><code class="language-crystal">totem <span class="o">=</span> <span class="t">Totem</span>.<span class="k">new</span>(<span class="s">&quot;config&quot;</span>, <span class="s">&quot;/etc/totem/&quot;</span>)  <span class="c"># =&gt; New a instance with name and path of config file</span>
totem.config_paths <span class="o">&lt;&lt;</span> <span class="s">&quot;~/.totem&quot;</span>            <span class="c"># =&gt; path to look for the config file in</span>
totem.config_paths <span class="o">&lt;&lt;</span> <span class="s">&quot;./config&quot;</span>            <span class="c"># =&gt; optionally look for config in the working directory</span>
<span class="k">begin</span>
  totem.load!                               <span class="c"># =&gt; Find and read the config file (order by yaml/yml/json/env)</span>
<span class="k">rescue</span> e
  puts <span class="s">&quot;Fatal error config file: </span><span class="i">#{</span>e.message<span class="i">}</span><span class="s">&quot;</span>
<span class="k">end</span></code></pre>

<h3>Set Alias and using alias</h3>

<p>Aliases permit a single value to be referenced by multiple keys</p>

<pre><code class="language-crystal">totem.<span class="k">alias</span>(<span class="s">&quot;nickname&quot;</span>, <span class="s">&quot;Name&quot;</span>)

totem.set(<span class="s">&quot;name&quot;</span>, <span class="s">&quot;foo&quot;</span>)
totem.set(<span class="s">&quot;nickname&quot;</span>, <span class="s">&quot;bar&quot;</span>)

totem.get(<span class="s">&quot;name&quot;</span>)       <span class="c"># =&gt; &quot;foo&quot;</span>
totem.get(<span class="s">&quot;nickname&quot;</span>)   <span class="c"># =&gt; &quot;foo&quot;</span></code></pre>

<h3>Working with nested key</h3>

<p>All accessor methods accept nested key:</p>

<pre><code class="language-crystal">totem.set_default(<span class="s">&quot;profile.user.name&quot;</span>, <span class="s">&quot;foo&quot;</span>)
totem.set(<span class="s">&quot;profile.user.age&quot;</span>, <span class="n">13</span>)
totem.<span class="k">alias</span>(<span class="s">&quot;username&quot;</span>, <span class="s">&quot;profile.user.name&quot;</span>)
totem.bind_env(<span class="s">&quot;profile.user.nickname&quot;</span>, <span class="s">&quot;PROFILE_USER_NICKNAME&quot;</span>)
totem.get(<span class="s">&quot;profile.user.age&quot;</span>)</code></pre>

<h3>Working with envoriment variables</h3>

<p>Totem has full support for environment variables, example:</p>

<pre><code class="language-crystal"><span class="t">ENV</span>[<span class="s">&quot;ID&quot;</span>] <span class="o">=</span> <span class="s">&quot;123&quot;</span>
<span class="t">ENV</span>[<span class="s">&quot;FOOD&quot;</span>] <span class="o">=</span> <span class="s">&quot;Pinapple&quot;</span>
<span class="t">ENV</span>[<span class="s">&quot;NAME&quot;</span>] <span class="o">=</span> <span class="s">&quot;Polly&quot;</span>

totem <span class="o">=</span> <span class="t">Totem</span>.<span class="k">new</span>

totem.bind_env(<span class="s">&quot;ID&quot;</span>)
totem.get(<span class="s">&quot;id&quot;</span>).as_i        <span class="c"># =&gt; 123</span>

totem.bind_env(<span class="s">&quot;f&quot;</span>, <span class="s">&quot;FOOD&quot;</span>)
totem.get(<span class="s">&quot;f&quot;</span>).as_s         <span class="c"># =&gt; &quot;Pinapple&quot;</span>

totem.automative_env
totem.get(<span class="s">&quot;name&quot;</span>).as_s      <span class="c"># =&gt; &quot;Polly&quot;</span></code></pre>

<p>Working with envoriment prefix:</p>

<pre><code class="language-crystal">totem.automative_env(prefix: <span class="s">&quot;totem&quot;</span>)
<span class="c"># Same as</span>
<span class="c"># totem.env_prefix = &quot;totem&quot;</span>
<span class="c"># totem.automative_env = true</span>

totem.get(<span class="s">&quot;id&quot;</span>).as_i    <span class="c"># =&gt; 123</span>
totem.get(<span class="s">&quot;food&quot;</span>).as_s  <span class="c"># =&gt; &quot;Pinapple&quot;</span>
totem.get(<span class="s">&quot;name&quot;</span>).as_s  <span class="c"># =&gt; &quot;Polly&quot;</span></code></pre>

<h3>Working with remote providers</h3>

<p>Totem retrieve configuration from Key-Value store, which means that you can get your configuration values on the air.
Avaliable providers is <code>redis</code> and <code>etcd</code>.</p>

<h4>Use redis</h4>

<p>It dependency <a href="https://github.com/stefanwille/crystal-redis" target="_blank">redis</a> shard. Install is before use.</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;totem&quot;</span>
<span class="k">require</span> <span class="s">&quot;totem/remote_providers/redis&quot;</span>

totem <span class="o">=</span> <span class="t">Totem</span>.<span class="k">new</span>
totem.add_remote(provider: <span class="s">&quot;redis&quot;</span>, endpoint: <span class="s">&quot;redis://localhost:6379/0&quot;</span>)

totem.get(<span class="s">&quot;user:name&quot;</span>)      <span class="c"># =&gt; &quot;foo&quot;</span>
totem.get(<span class="s">&quot;user:id&quot;</span>).as_i   <span class="c"># =&gt; 123</span></code></pre>

<p>You can also get raw data from one key with <code>path</code>:</p>

<pre><code class="language-crystal">totem.config_type <span class="o">=</span> <span class="s">&quot;json&quot;</span>  <span class="c"># There is no file extension in a stream data, supported extensions are all registed config types in Totem.</span>
totem.add_remote(provider: <span class="s">&quot;redis&quot;</span>, endpoint: <span class="s">&quot;redis://localhost:6379/0&quot;</span>, path: <span class="s">&quot;config:development&quot;</span>)

totem.get(<span class="s">&quot;user:name&quot;</span>)      <span class="c"># =&gt; &quot;foo&quot;</span>
totem.get(<span class="s">&quot;user:id&quot;</span>).as_i   <span class="c"># =&gt; 123</span></code></pre>

<h4>Use etcd</h4>

<p>It dependency <a href="https://github.com/icyleaf/etcd-crystal" target="_blank">etcd-crystal</a> shard. Install is before use.</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;totem&quot;</span>
<span class="k">require</span> <span class="s">&quot;totem/remote_providers/etcd&quot;</span>

totem <span class="o">=</span> <span class="t">Totem</span>.<span class="k">new</span>
totem.add_remote(provider: <span class="s">&quot;etcd&quot;</span>, endpoint: <span class="s">&quot;http://localhost:2379&quot;</span>)

totem.get(<span class="s">&quot;user:name&quot;</span>)      <span class="c"># =&gt; &quot;foo&quot;</span>
totem.get(<span class="s">&quot;user:id&quot;</span>).as_i   <span class="c"># =&gt; 123</span></code></pre>

<p>You can also get raw data from one key with <code>path</code>:</p>

<pre><code class="language-crystal">totem.config_type <span class="o">=</span> <span class="s">&quot;yaml&quot;</span>  <span class="c"># There is no file extension in a stream data, supported extensions are all registed config types in Totem.</span>
totem.add_remote(provider: <span class="s">&quot;etcd&quot;</span>, endpoint: <span class="s">&quot;http://localhost:2379&quot;</span>, path: <span class="s">&quot;/config/development.yaml&quot;</span>)

totem.get(<span class="s">&quot;user:name&quot;</span>)      <span class="c"># =&gt; &quot;foo&quot;</span>
totem.get(<span class="s">&quot;user:id&quot;</span>).as_i   <span class="c"># =&gt; 123</span></code></pre>

<h3>Iterating configuration</h3>

<p>Iterate in Totem is very easy, you can get <code>#keys</code>, <code>#flat_keys</code>, <code>#settings</code> (a.k.a <code>#to_h</code>) even iterating it directly with <code>#each</code>:</p>

<pre><code class="language-crystal">totem.settings    <span class="c"># =&gt; {&quot;id&quot; =&gt; 123, &quot;user&quot; =&gt; {&quot;name&quot; =&gt; &quot;foobar&quot;, &quot;age&quot; =&gt; 20}}</span>
totem.keys        <span class="c"># =&gt; [&quot;id&quot;, &quot;user&quot;]</span>
totem.flat_keys   <span class="c"># =&gt; [&quot;id&quot;, &quot;user.name&quot;, &quot;user.age&quot;]</span>

totem.each <span class="k">do</span> <span class="o">|</span>key, value<span class="o">|</span>
  <span class="c"># do something</span>
<span class="k">end</span></code></pre>

<h3>Serialization</h3>

<p>Serialize configuration to <code>Struct</code>, at current stage you can pass a <code>JSON::Serializable</code>/<code>YAML::Serializable</code> struct to mapping.</p>

<pre><code class="language-crystal"><span class="k">struct</span> <span class="t">Profile</span>
  <span class="k">include</span> <span class="t">JSON</span><span class="t">::</span><span class="t">Serializable</span>

  property name : <span class="t">String</span>
  property hobbies : <span class="t">Array</span>(<span class="t">String</span>)
  property age : <span class="t">Int32</span>
  property eyes : <span class="t">String</span>
<span class="k">end</span>

totem <span class="o">=</span> <span class="t">Totem</span>.from_file <span class="s">&quot;spec/fixtures/config.yaml&quot;</span>
profile <span class="o">=</span> totem.mapping(<span class="t">Profile</span>)
profile.name      <span class="c"># =&gt; &quot;steve&quot;</span>
profile.age       <span class="c"># =&gt; 35</span>
profile.eyes      <span class="c"># =&gt; &quot;brown&quot;</span>
profile.hobbies   <span class="c"># =&gt; [&quot;skateboarding&quot;, &quot;snowboarding&quot;, &quot;go&quot;]</span></code></pre>

<p>Serialize configuration with part of key:</p>

<pre><code class="language-crystal"><span class="k">struct</span> <span class="t">Clothes</span>
  <span class="k">include</span> <span class="t">JSON</span><span class="t">::</span><span class="t">Serializable</span>

  property jacket : <span class="t">String</span>
  property trousers : <span class="t">String</span>
  property pants : <span class="t">Hash</span>(<span class="t">String</span>, <span class="t">String</span>)
<span class="k">end</span>

totem <span class="o">=</span> <span class="t">Totem</span>.from_file <span class="s">&quot;spec/fixtures/config.yaml&quot;</span>
clothes <span class="o">=</span> profile.mapping(<span class="t">Clothes</span>, <span class="s">&quot;clothing&quot;</span>)
<span class="c"># =&gt; Clothes(@jacket=&quot;leather&quot;, @pants={&quot;size&quot; =&gt; &quot;large&quot;}, @trousers=&quot;denim&quot;)</span></code></pre>

<h3>Storing configuration to file</h3>

<p>Simple to use <code>#store!</code> method.</p>

<pre><code class="language-crystal">raw <span class="o">=</span> <span class="s">&lt;&lt;-EOF
Hacker: true
name: steve
hobbies:
- skateboarding
- snowboarding
- go
clothing:
  jacket: leather
  trousers: denim
  pants:
    size: large
age: 35
eyes : brown
EOF</span>

totem <span class="o">=</span> <span class="t">Totem</span>.from_yaml raw
totem.set(<span class="s">&quot;nickname&quot;</span>, <span class="s">&quot;Freda&quot;</span>)
totem.set(<span class="s">&quot;eyes&quot;</span>, <span class="s">&quot;blue&quot;</span>)
totem.store!(<span class="s">&quot;profile.json&quot;</span>)</code></pre>

<h2>Advanced Usage</h2>

<h3>Write a config adapter</h3>

<p>Creating the custom adapter by integration <code><a href="Totem/ConfigTypes/Adapter.html">Totem::ConfigTypes::Adapter</a></code> abstract class. Here has two methods must be implement:
<code>read</code> and <code>write</code>. For example, let us write a INI adapter:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;ini&quot;</span>

<span class="k">class</span> <span class="t">INIAdapter</span> <span class="o">&lt;</span> <span class="t">Totem</span><span class="t">::</span><span class="t">ConfigTypes</span><span class="t">::</span><span class="t">Adapter</span>
  <span class="k">def</span> <span class="m">read</span>(raw)
    <span class="t">INI</span>.parse(raw)
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">write</span>(io, config)
    config.settings.each <span class="k">do</span> <span class="o">|</span>key, items<span class="o">|</span>
      <span class="k">next</span> <span class="k">unless</span> data <span class="o">=</span> items.as_h?
      io <span class="o">&lt;&lt;</span> <span class="s">&quot;[&quot;</span> <span class="o">&lt;&lt;</span> key <span class="o">&lt;&lt;</span> <span class="s">&quot;]\n&quot;</span>
      data.each <span class="k">do</span> <span class="o">|</span>name, value<span class="o">|</span>
        io <span class="o">&lt;&lt;</span> name <span class="o">&lt;&lt;</span> <span class="s">&quot; = &quot;</span> <span class="o">&lt;&lt;</span> value <span class="o">&lt;&lt;</span> <span class="s">&quot;\n&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c"># Do not forget register it</span>
<span class="t">Totem</span><span class="t">::</span><span class="t">ConfigTypes</span>.register_adapter(<span class="s">&quot;ini&quot;</span>, <span class="t">INIAdapter</span>.<span class="k">new</span>)
<span class="c"># Also you can set aliases</span>
<span class="t">Totem</span><span class="t">::</span><span class="t">ConfigTypes</span>.register_alias(<span class="s">&quot;cnf&quot;</span>, <span class="s">&quot;ini&quot;</span>)</code></pre>

<p>More examples to review <a href="https://github.com/icyleaf/totem/blob/master/src/totem/config_types" target="_blank">built-in adapters</a>.</p>

<h3>Write a remote provider</h3>

<p>Creating the custom remote provider by integration <code><a href="Totem/RemoteProviders/Adapter.html">Totem::RemoteProviders::Adapter</a></code> abstract class. Here has two methods must be implement:
<code>read</code> and <code>get</code>, please reivew the <a href="https://github.com/icyleaf/totem/blob/master/src/totem/remote_providers" target="_blank">built-in remote providers</a>.</p>

<h2>Q & A</h2>

<h3>How to debug?</h3>

<p>You can use Crystal built-in <code>#pp</code> or <code>#pp!</code> method to prints a series of instance variables:</p>

<pre><code><span class="c">#&lt;Totem::Config</span>
 @config_paths<span class="o">=</span>[<span class="s">&quot;/etc/totem&quot;</span>, <span class="s">&quot;~/.totem&quot;</span>],
 @config_name<span class="o">=</span><span class="s">&quot;config&quot;</span>,
 @config_type<span class="o">=</span><span class="s">&quot;json&quot;</span>,
 @key_delimiter<span class="o">=</span><span class="s">&quot;.&quot;</span>,
 @automatic_env<span class="o">=</span><span class="n">false</span>,
 @env_prefix<span class="o">=</span><span class="n">nil</span>,
 @aliases<span class="o">=</span>{<span class="s">&quot;user&quot;</span> => <span class="s">&quot;profile.user.name&quot;</span>},
 @overrides<span class="o">=</span>{<span class="s">&quot;profile&quot;</span> => {<span class="s">&quot;user&quot;</span> => {<span class="s">&quot;gender&quot;</span> => <span class="s">&quot;male&quot;</span>}}, <span class="s">&quot;name&quot;</span> => <span class="s">&quot;foo&quot;</span>},
 @config<span class="o">=</span>{<span class="s">&quot;profile&quot;</span> => {<span class="s">&quot;user&quot;</span> => {<span class="s">&quot;gender&quot;</span> => <span class="s">&quot;unkown&quot;</span>}}, <span class="s">&quot;name&quot;</span> => <span class="s">&quot;bar&quot;</span>}},
 @env<span class="o">=</span>{<span class="s">&quot;name&quot;</span> => <span class="s">&quot;TOTEM_NAME&quot;</span>},
 @defaults<span class="o">=</span>{<span class="s">&quot;name&quot;</span> => <span class="s">&quot;alana&quot;</span>}<span class="o">&gt;</span></code></pre>

<h2>Help and Discussion</h2>

<p>You can browse the API documents:</p>

<p>https://icyleaf.github.io/totem/</p>

<p>You can browse the Changelog:</p>

<p>https://github.com/icyleaf/totem/blob/master/CHANGELOG.md</p>

<p>If you have found a bug, please create a issue here:</p>

<p>https://github.com/icyleaf/totem/issues/new</p>

<h2>Donate</h2>

<p>Totem is a open source, collaboratively funded project. If you run a business and are using Totem in a revenue-generating product,
it would make business sense to sponsor Totem development. Individual users are also welcome to make a one time donation
if Totem has helped you in your work or personal projects.</p>

<p>You can donate via <a href="https://www.paypal.me/icyleaf/5" target="_blank">Paypal</a>.</p>

<h2>How to Contribute</h2>

<p>Your contributions are always welcome! Please submit a pull request or create an issue to add a new question, bug or feature to the list.</p>

<p>All <a href="https://github.com/icyleaf/totem/graphs/contributors" target="_blank">Contributors</a> are on the wall.</p>

<h2>You may also like</h2>

<ul><li><a href="https://github.com/icyleaf/halite" target="_blank">halite</a> - HTTP Requests Client with a chainable REST API, built-in sessions and middlewares.</li><li><a href="https://github.com/icyleaf/markd" target="_blank">markd</a> - Yet another markdown parser built for speed, Compliant to CommonMark specification.</li><li><a href="https://github.com/icyleaf/poncho" target="_blank">poncho</a> - A .env parser/loader improved for performance.</li><li><a href="https://github.com/icyleaf/popcorn" target="_blank">popcorn</a> - Easy and Safe casting from one type to another.</li><li><a href="https://github.com/icyleaf/fast-crystal" target="_blank">fast-crystal</a> - üí® Writing Fast Crystal üòç -- Collect Common Crystal idioms.</li></ul>

<h2>License</h2>

<p><a href="https://github.com/icyleaf/totem/blob/master/LICENSE" target="_blank">MIT License</a> ¬© icyleaf</p>
</div>
</body>
</html>
